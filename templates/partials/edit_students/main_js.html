<!-- templates/partials/edit_students/main_js.html -->
<script>
    $(document).ready(function() {
        // –¢–û–õ–¨–ö–û –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏ Select2
        $('#studentSelect').select2({
            language: "ru",
            placeholder: "–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –∏–º—è —É—á–µ–Ω–∏–∫–∞",
            allowClear: true
        });

        // –¢–û–õ–¨–ö–û –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –≤—ã–±–æ—Ä–µ
        $('#studentSelect').change(function() {
            const studentId = $(this).val();
            if (studentId) {
                loadStudentData(studentId);
                $('#studentCard').removeClass('hidden');
            } else {
                $('#studentCard').addClass('hidden');
            }
        });
    });

    // –¢–û–õ–¨–ö–û —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
    function loadStudentData(studentId) {
        console.log('üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —É—á–µ–Ω–∏–∫–∞ ID:', studentId);

        $.get(`/edit-students/get-student-data/${studentId}`, function(student) {
            console.log('‚úÖ –ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ —É—á–µ–Ω–∏–∫–∞:', student);

            // –ü—Ä–æ—Å—Ç–æ –∑–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è - –Ω–∏—á–µ–≥–æ –±–æ–ª—å—à–µ!
            $('#studentId').val(student.id);
            $('#name').val(student.name || '');
            $('#birthday').val(student.birthday ? student.birthday.split('T')[0] : '');
            // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
            $('#active').prop('checked', student.active !== false);

            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            loadStudentParents(studentId);
            loadMedicalCertificates(studentId);
            loadAwards(studentId);

        }).fail(function(error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —É—á–µ–Ω–∏–∫–∞:', error);
            showMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö', 'danger');
        });
    }

    function showMessage(text, type) {
        $('#message').html(`
            <div class="alert alert-${type}">
                ${text}
            </div>
        `);
    }
</script>