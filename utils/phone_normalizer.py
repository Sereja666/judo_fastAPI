import re
from typing import Optional


def normalize_phone(phone: str) -> Optional[str]:
    """
    –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞:
    - –£–¥–∞–ª—è–µ—Ç –≤—Å–µ –Ω–µ—Ü–∏—Ñ—Ä–æ–≤—ã–µ —Å–∏–º–≤–æ–ª—ã
    - –ü—Ä–∏–≤–æ–¥–∏—Ç –∫ —Ñ–æ—Ä–º–∞—Ç—É +7XXXXXXXXXX

    –í–ê–ñ–ù–û: –ï—Å–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω —É–∂–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ +7XXXXXXXXXX, –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å!
    """
    if not phone:
        return None

    # –£–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–µ–ª—ã –∏ –¥—Ä—É–≥–∏–µ —Å–∏–º–≤–æ–ª—ã
    phone = phone.strip()

    # –ï—Å–ª–∏ —É–∂–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å +7 –∏ 11 —Ü–∏—Ñ—Ä –ø–æ—Å–ª–µ, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
    if phone.startswith('+7') and len(phone) == 12 and phone[1:].isdigit():
        return phone

    # –£–¥–∞–ª—è–µ–º –≤—Å–µ –Ω–µ—Ü–∏—Ñ—Ä–æ–≤—ã–µ —Å–∏–º–≤–æ–ª—ã
    digits = re.sub(r'\D', '', phone)

    # –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å
    if not digits:
        return None

    # –ï—Å–ª–∏ –Ω–æ–º–µ—Ä –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 7 –∏ –¥–ª–∏–Ω–∞ 11 —Ü–∏—Ñ—Ä
    if digits.startswith('7') and len(digits) == 11:
        return f'+{digits}'

    # –ï—Å–ª–∏ –Ω–æ–º–µ—Ä –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 8 –∏ –¥–ª–∏–Ω–∞ 11 —Ü–∏—Ñ—Ä (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π –Ω–æ–º–µ—Ä)
    if digits.startswith('8') and len(digits) == 11:
        return f'+7{digits[1:]}'

    # –ï—Å–ª–∏ –Ω–æ–º–µ—Ä 10 —Ü–∏—Ñ—Ä (–±–µ–∑ –∫–æ–¥–∞ —Å—Ç—Ä–∞–Ω—ã)
    if len(digits) == 10:
        return f'+7{digits}'

    # –ï—Å–ª–∏ –Ω–æ–º–µ—Ä 11 —Ü–∏—Ñ—Ä –∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –Ω–µ —Å 7 –∏–ª–∏ 8 (–º–æ–∂–µ—Ç –±—ã—Ç—å 9...)
    if len(digits) == 11:
        return f'+7{digits[1:]}'

    # –ï—Å–ª–∏ –Ω–æ–º–µ—Ä 12 —Ü–∏—Ñ—Ä (—É–∂–µ —Å +7 –Ω–æ –±–µ–∑ + –≤ digits)
    if len(digits) == 12 and digits.startswith('7'):
        return f'+{digits}'

    # –í–æ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å, –Ω–æ –¥–æ–±–∞–≤–ª—è–µ–º +
    if digits.startswith('7'):
        return f'+{digits}'
    else:
        # –ë–µ—Ä–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Ü–∏—Ñ—Ä –∏ –¥–æ–±–∞–≤–ª—è–µ–º +7
        return f'+7{digits[-10:]}'


def is_valid_phone(phone: str) -> bool:
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞"""
    normalized = normalize_phone(phone)
    if not normalized:
        return False

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç +7XXXXXXXXXX (12 —Å–∏–º–≤–æ–ª–æ–≤)
    return bool(re.match(r'^\+7\d{10}$', normalized))


# –¢–µ—Å—Ç—ã
if __name__ == "__main__":
    test_cases = [
        ("+79184508448", "+79184508448"),
        ("79184508448", "+79184508448"),
        ("89184508448", "+79184508448"),
        ("8 (918) 450-84-48", "+79184508448"),
        ("9184508448", "+79184508448"),
        ("+7 918 450 84 48", "+79184508448"),
        ("7 918 450 84 48", "+79184508448"),
        ("—Ç–µ–ª.: 8-918-450-84-48", "+79184508448"),
        ("+79184508448 ", "+79184508448"),  # —Å –ø—Ä–æ–±–µ–ª–æ–º –≤ –∫–æ–Ω—Ü–µ
        (" +79184508448", "+79184508448"),  # —Å –ø—Ä–æ–±–µ–ª–æ–º –≤ –Ω–∞—á–∞–ª–µ
    ]

    print("üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ normalize_phone:")
    for input_phone, expected in test_cases:
        result = normalize_phone(input_phone)
        status = "‚úÖ" if result == expected else "‚ùå"
        print(f"{status} '{input_phone}' -> '{result}' (–æ–∂–∏–¥–∞–ª–æ—Å—å: '{expected}')")