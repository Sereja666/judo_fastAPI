<!-- templates/partials/edit_students/main_js.html -->
<script>
    $(document).ready(function() {
        // ================== –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ö–ù–û–ü–ö–ò –°–û–•–†–ê–ù–ï–ù–ò–Ø ==================
        console.log('üîß –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–æ—Ä–º—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —É—á–µ–Ω–∏–∫–æ–≤');

        // 1. –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –Ω–∞—Ö–æ–¥–∏–º –∫–Ω–æ–ø–∫—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        function initSaveButton() {
            console.log('üîç –ü–æ–∏—Å–∫ –∫–Ω–æ–ø–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è...');

            // –ò—â–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∫–Ω–æ–ø–∫—É
            let saveButton = $('#studentForm button').filter(function() {
                const text = $(this).text().trim().toLowerCase();
                return text.includes('—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è') ||
                       text.includes('—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å') ||
                       $(this).hasClass('btn-primary') ||
                       $(this).hasClass('btn-lg');
            }).first();

            // –ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é
            if (!saveButton.length) {
                console.log('‚ö†Ô∏è –ö–Ω–æ–ø–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, —Å–æ–∑–¥–∞—é –Ω–æ–≤—É—é...');
                saveButton = $(`
                    <button type="submit" class="btn btn-primary btn-lg" id="mainSaveButton">
                        <i class="fas fa-save"></i>
                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                    </button>
                `);

                // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –≤ —Ñ–æ—Ä–º—É
                $('#studentForm').append(saveButton);
                console.log('‚úÖ –°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
            } else {
                console.log('‚úÖ –ù–∞–π–¥–µ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∫–Ω–æ–ø–∫–∞:', saveButton);

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –¥–æ–±–∞–≤–ª—è–µ–º type="submit" –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
                if (!saveButton.attr('type')) {
                    saveButton.attr('type', 'submit');
                    console.log('‚úÖ –î–æ–±–∞–≤–ª–µ–Ω type="submit" –∫ –∫–Ω–æ–ø–∫–µ');
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                const buttonText = saveButton.text().trim().toLowerCase();
                if (!buttonText.includes('—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å')) {
                    saveButton.html('<i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è');
                    console.log('‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏');
                }
            }

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–æ–ø–∫—É
            window.saveButtonElement = saveButton[0];
            return saveButton;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
        const saveButton = initSaveButton();
        console.log('‚úÖ –ö–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≥–æ—Ç–æ–≤–∞:', saveButton);

        // ================== –û–°–ù–û–í–ù–ê–Ø –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==================

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Select2 –¥–ª—è –ø–æ–∏—Å–∫–∞ —É—á–µ–Ω–∏–∫–æ–≤
        $('#studentSelect').select2({
            language: "ru",
            placeholder: "–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –∏–º—è —É—á–µ–Ω–∏–∫–∞",
            allowClear: true
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —É—á–µ–Ω–∏–∫–∞ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ
        $('#studentSelect').change(function() {
            const studentId = $(this).val();
            if (studentId) {
                loadStudentData(studentId);
                $('#studentCard').removeClass('hidden');
                $('#studentCard h3').text('–ö–∞—Ä—Ç–æ—á–∫–∞ —É—á–µ–Ω–∏–∫–∞');
                saveButton.html('<i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è');
            } else {
                $('#studentCard').addClass('hidden');
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã —É—á–µ–Ω–∏–∫–∞
        $('#studentForm').submit(function(e) {
            e.preventDefault();
            console.log('üéØ –°–æ–±—ã—Ç–∏–µ submit —Ñ–æ—Ä–º—ã!');
            updateStudent();
        });

        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
        saveButton.on('click', function(e) {
            console.log('üéØ –°–æ–±—ã—Ç–∏–µ click –∫–Ω–æ–ø–∫–∏!');
            // –ù–µ –≤—ã–∑—ã–≤–∞–µ–º preventDefault –∑–¥–µ—Å—å, —á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞—Ç—å submit —Å–æ–±—ã—Ç–∏—é
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è —Å–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        $('#certificateModal').on('hidden.bs.modal', function () {
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            $('#certificateForm')[0].reset();
            $('#cert_id').prop('disabled', false);
            $('#deleteCertificateBtn').addClass('hidden');
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è —Å–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –Ω–∞–≥—Ä–∞–¥
        $('#awardModal').on('hidden.bs.modal', function () {
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            $('#awardForm')[0].reset();
            $('#competition_id').prop('disabled', false);
            $('#deleteAwardBtn').addClass('hidden');
        });

        console.log('‚úÖ –í—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã');
    });

    // ================== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò –£–ß–ï–ù–ò–ö–ê ==================

    function loadStudentData(studentId) {
        console.log('üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —É—á–µ–Ω–∏–∫–∞ ID:', studentId);

        $.get(`/edit-students/get-student-data/${studentId}`, function(student) {
            console.log('‚úÖ –ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ —É—á–µ–Ω–∏–∫–∞:', student);

            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É –¥–∞–Ω–Ω—ã–º–∏ —É—á–µ–Ω–∏–∫–∞
            $('#studentId').val(student.id);
            $('#name').val(student.name || '');
            $('#birthday').val(student.birthday ? student.birthday.split('T')[0] : '');
            $('#sport_discipline').val(student.sport_discipline || '');
            $('#rang').val(student.rang || '');
            $('#sports_rank').val(student.sports_rank || '');
            $('#sex').val(student.sex || '');
            $('#weight').val(student.weight || '');
            $('#telephone').val(student.telephone || '');
            $('#head_trainer_id').val(student.head_trainer_id || '');
            $('#second_trainer_id').val(student.second_trainer_id || '');
            $('#price').val(student.price || '');
            $('#payment_day').val(student.payment_day || '');
            $('#classes_remaining').val(student.classes_remaining || '');
            $('#expected_payment_date').val(student.expected_payment_date ? student.expected_payment_date.split('T')[0] : '');
            $('#parent1').val(student.parent1 || '');
            $('#parent2').val(student.parent2 || '');
            $('#date_start').val(student.date_start ? student.date_start.replace('Z', '').substring(0, 16) : '');
            $('#telegram_id').val(student.telegram_id || '');
            $('#active').prop('checked', student.active !== false);

            console.log('rang (belt color ID):', student.rang);
            console.log('sports_rank:', student.sports_rank);

            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —Ç–∞—Ä–∏—Ñ–µ
            if (student.price) {
                const selectedOption = $('#price').find(`option[value="${student.price}"]`);
                if (selectedOption.length) {
                    const priceAmount = selectedOption.data('price-amount');
                    const classesCount = selectedOption.data('classes-count');

                    let infoText = '';
                    if (priceAmount) {
                        infoText += `–°—Ç–æ–∏–º–æ—Å—Ç—å: ${priceAmount} —Ä—É–±. `;
                    }
                    if (classesCount) {
                        infoText += `–ó–∞–Ω—è—Ç–∏–π –≤ —Ç–∞—Ä–∏—Ñ–µ: ${classesCount}`;
                    }

                    $('#priceInfo').text(infoText);
                }
            }
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–æ–¥–∏—Ç–µ–ª–µ–π —É—á–µ–Ω–∏–∫–∞
            loadStudentParents(studentId);
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ —Å–ø—Ä–∞–≤–∫–∏ –ü–û–°–õ–ï –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            loadMedicalCertificates(studentId);

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞–≥—Ä–∞–¥—ã –ü–û–°–õ–ï –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            loadAwards(studentId);

        }).fail(function(xhr, status, error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —É—á–µ–Ω–∏–∫–∞:', error);
            showMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —É—á–µ–Ω–∏–∫–∞: ' + error, 'danger');
        });
    }

    function loadStudentParents(studentId) {
        console.log('üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–æ–¥–∏—Ç–µ–ª–µ–π —É—á–µ–Ω–∏–∫–∞ ID:', studentId);

        $.get(`/edit-students/get-parents/${studentId}`, function(parents) {
            console.log('‚úÖ –ü–æ–ª—É—á–µ–Ω—ã —Ä–æ–¥–∏—Ç–µ–ª–∏ —É—á–µ–Ω–∏–∫–∞:', parents);

            const container = $('#parentsContainer');
            const placeholder = $('#parentsPlaceholder');

            if (parents && parents.length > 0) {
                placeholder.hide();

                let html = '<div class="list-group">';
                parents.forEach(parent => {
                    html += `
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <strong>${parent.full_name || parent.telegram_username || '–†–æ–¥–∏—Ç–µ–ª—å'}</strong>
                            <br>
                            <small class="text-muted">
                                ${parent.phone ? 'üì± ' + parent.phone + ' ' : ''}
                                ${parent.email ? 'üìß ' + parent.email + ' ' : ''}
                                ${parent.telegram_username ? 'üë§ @' + parent.telegram_username : ''}
                            </small>
                        </div>
                        <button class="btn btn-outline-danger btn-sm" onclick="removeParent(${parent.relation_id}, this)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    `;
                });
                html += '</div>';

                container.html(html);
            } else {
                placeholder.show();
                container.html('<div class="text-muted" id="parentsPlaceholder">–£ –¥–∞–Ω–Ω–æ–≥–æ —É—á–µ–Ω–∏–∫–∞ –ø–æ–∫–∞ –Ω–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ä–æ–¥–∏—Ç–µ–ª–µ–π</div>');
            }

        }).fail(function(xhr, status, error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–æ–¥–∏—Ç–µ–ª–µ–π:', error);
            showMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ —Ä–æ–¥–∏—Ç–µ–ª–µ–π', 'warning');
        });
    }

    function updateStudent() {
        const formData = new FormData(document.getElementById('studentForm'));
        const studentId = $('#studentId').val();

        console.log('üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö —É—á–µ–Ω–∏–∫–∞:', Object.fromEntries(formData));
        console.log('Student ID:', studentId);

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
        const name = $('#name').val();
        if (!name) {
            showMessage('–§–ò–û —É—á–µ–Ω–∏–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è', 'danger');
            return;
        }

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º URL –∏ –º–µ—Ç–æ–¥ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, –Ω–æ–≤—ã–π —ç—Ç–æ —É—á–µ–Ω–∏–∫ –∏–ª–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
        const url = studentId === 'new' ? '/edit-students/create-student' : '/edit-students/update-student';
        const method = 'POST';

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
        const saveButton = $('button[type="submit"]', '#studentForm').first();
        const originalHTML = saveButton.html();
        saveButton.html('<i class="fas fa-spinner fa-spin me-1"></i> –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...');
        saveButton.prop('disabled', true);

        fetch(url, {
            method: method,
            body: formData
        })
        .then(response => {
            if (!response.ok) {
                return response.text().then(text => {
                    throw new Error(`HTTP error! status: ${response.status}, message: ${text}`);
                });
            }
            return response.json();
        })
        .then(data => {
            console.log('‚úÖ –û—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', data);
            showMessage(data.message, 'success');

            if (studentId === 'new') {
                // –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ —É—á–µ–Ω–∏–∫–∞
                $('#studentId').val(data.student_id);
                $('#studentCard h3').text('–ö–∞—Ä—Ç–æ—á–∫–∞ —É—á–µ–Ω–∏–∫–∞');
                saveButton.html('<i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è');

                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–≥–æ —É—á–µ–Ω–∏–∫–∞ –≤ –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫
                const newStudentName = $('#name').val();
                const newStudentId = data.student_id;
                $('#studentSelect').append(new Option(newStudentName, newStudentId));
                $('#studentSelect').val(newStudentId).trigger('change');
            } else {
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–º—è –≤ –≤—ã–ø–∞–¥–∞—é—â–µ–º —Å–ø–∏—Å–∫–µ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —É—á–µ–Ω–∏–∫–∞
                const studentSelect = $('#studentSelect');
                const currentStudentId = $('#studentId').val();
                const currentStudentName = $('#name').val();
                studentSelect.find(`option[value="${currentStudentId}"]`).text(currentStudentName);
            }
        })
        .catch(error => {
            console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
            showMessage('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + error.message, 'danger');
        })
        .finally(() => {
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
            saveButton.html(originalHTML);
            saveButton.prop('disabled', false);
        });
    }

    function showMessage(text, type) {
        $('#message').html(`
            <div class="alert alert-${type} alert-dismissible fade show" role="alert">
                ${text}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        `);

        setTimeout(() => {
            $('.alert').alert('close');
        }, 5000);
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞ —Ç–∞—Ä–∏—Ñ–∞
    $('#price').change(function() {
        const selectedOption = $(this).find('option:selected');
        const priceAmount = selectedOption.data('price-amount');
        const classesCount = selectedOption.data('classes-count');

        let infoText = '';
        if (priceAmount) {
            infoText += `–°—Ç–æ–∏–º–æ—Å—Ç—å: ${priceAmount} —Ä—É–±. `;
        }
        if (classesCount) {
            infoText += `–ó–∞–Ω—è—Ç–∏–π –≤ —Ç–∞—Ä–∏—Ñ–µ: ${classesCount}`;
        }

        $('#priceInfo').text(infoText);

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–Ω—è—Ç–∏–π –µ—Å–ª–∏ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ
        if (classesCount && !$('#classes_remaining').val()) {
            $('#classes_remaining').val(classesCount);
        }
    });

    function createNewStudent() {
        // –°–∫—Ä—ã–≤–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É —Ç–µ–∫—É—â–µ–≥–æ —É—á–µ–Ω–∏–∫–∞
        $('#studentCard').addClass('hidden');

        // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
        $('#studentForm')[0].reset();

        // –£–±–∏—Ä–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —É—á–µ–Ω–∏–∫–∞ –∏–∑ select
        $('#studentSelect').val('').trigger('change');

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –≤ –ø–æ–ª–µ "–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫"
        const now = new Date();
        const localDateTime = now.toISOString().slice(0, 16);
        $('#date_start').val(localDateTime);

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —Å—Ç–∞—Ç—É—Å (–≥–∞–ª–æ—á–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞)
        $('#active').prop('checked', true);

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –Ω–æ–≤–æ–≥–æ —É—á–µ–Ω–∏–∫–∞
        $('#studentId').val('new');

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É —Å –ø—É—Å—Ç–æ–π —Ñ–æ—Ä–º–æ–π
        $('#studentCard').removeClass('hidden');

        // –ú–µ–Ω—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
        $('#studentCard h3').text('–ù–æ–≤—ã–π —É—á–µ–Ω–∏–∫');

        // –ú–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        const saveButton = $('button[type="submit"]', '#studentForm').first();
        if (saveButton.length) {
            saveButton.html('<i class="fas fa-user-plus"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∞–Ω–∫–µ—Ç—É');
        }

        // –°–∫—Ä—ã–≤–∞–µ–º —Å–ø—Ä–∞–≤–∫–∏ –∏ –Ω–∞–≥—Ä–∞–¥—ã –¥–ª—è –Ω–æ–≤–æ–≥–æ —É—á–µ–Ω–∏–∫–∞
        $('#certificatesContainer').html('<div class="text-muted">–°–ø—Ä–∞–≤–∫–∏ –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —É—á–µ–Ω–∏–∫–∞</div>');
        $('#awardsContainer').html('<div class="text-muted">–ù–∞–≥—Ä–∞–¥—ã –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —É—á–µ–Ω–∏–∫–∞</div>');

        showMessage('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –Ω–æ–≤–æ–≥–æ —É—á–µ–Ω–∏–∫–∞', 'info');
    }

    // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
    function debugForm() {
        console.log('=== –î–ï–ë–ê–ì –§–û–†–ú–´ ===');
        console.log('–§–æ—Ä–º–∞:', document.getElementById('studentForm'));

        const buttons = $('#studentForm button');
        console.log('–ö–Ω–æ–ø–∫–∏ –≤ —Ñ–æ—Ä–º–µ:', buttons.length);
        buttons.each(function(i) {
            console.log(`${i}:`, $(this).prop('outerHTML'));
        });

        const submitButtons = $('#studentForm button[type="submit"]');
        console.log('–ö–Ω–æ–ø–∫–∏ —Å type="submit":', submitButtons.length);

        const form = document.getElementById('studentForm');
        const eventListeners = form.getEventListeners ? form.getEventListeners('submit') : 'N/A';
        console.log('–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ submit –Ω–∞ —Ñ–æ—Ä–º–µ:', eventListeners);
    }

    // –í—ã–∑—ã–≤–∞–µ–º –æ—Ç–ª–∞–¥–∫—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ (–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –ø–æ–∑–∂–µ)
    setTimeout(debugForm, 1000);
</script>