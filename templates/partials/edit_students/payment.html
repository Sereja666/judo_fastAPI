<!-- templates/partials/edit_students/payment.html -->
<div class="form-section">
    <h5 class="section-title">
        <i class="fas fa-credit-card me-2"></i>
        Оплата и занятия
    </h5>

    <!-- Кнопки для управления -->
    <div class="mb-4">
        <div class="d-flex flex-wrap gap-3">
            <button type="button" class="btn btn-success btn-lg" id="openPaymentModal">
                <i class="fas fa-credit-card me-2"></i>
                Обработать оплату
            </button>

            <button type="button" class="btn btn-info btn-lg" id="openMedicalCertModal">
                <i class="fas fa-file-medical me-2"></i>
                Справка по болезни
            </button>

            <button type="button" class="btn btn-warning btn-lg" id="manualBalanceEdit">
                <i class="fas fa-edit me-2"></i>
                Ручное редактирование баланса
            </button>
            <button type="button" class="btn btn-outline-info btn-lg" id="viewBalanceHistory">
                <i class="fas fa-history me-2"></i>
                История изменений
            </button>
            <div class="ms-auto">
                <div class="badge bg-info text-white p-2">
                    <i class="fas fa-calendar-day me-1"></i>
                    День оплаты: <span id="paymentDayDisplay">--</span>
                </div>
            </div>
        </div>
        <div id="paymentStatus" class="mt-2 small text-muted"></div>
    </div>

    <div class="row">
        <div class="col-md-4 mb-3">
            <label for="price" class="form-label fw-bold">
                <i class="fas fa-tag me-1"></i>
                Текущий тариф
            </label>
            <select class="form-select" id="price" name="price">
                <option value="">-- Выберите тариф --</option>
                {% for price in prices %}
                <option value="{{ price.id }}"
                        data-price-amount="{{ price.price }}"
                        data-classes-count="{{ price.classes_in_price or 0 }}">
                    {% if price.description %}
                    {{ price.description }}
                    {% else %}
                    Тариф {{ price.id }}
                    {% endif %}
                    - {{ price.price }} руб.
                    {% if price.classes_in_price %}
                    ({{ price.classes_in_price }} занятий)
                    {% endif %}
                </option>
                {% endfor %}
            </select>
            <div class="form-text" id="priceInfo"></div>
        </div>

        <div class="col-md-4 mb-3">
            <label for="classes_remaining" class="form-label fw-bold">
                <i class="fas fa-calendar-check me-1"></i>
                Остаток занятий
            </label>
            <div class="input-group input-group-lg">
                <input type="number" class="form-control" id="classes_remaining" name="classes_remaining"
                       min="0" style="font-size: 1.2rem; font-weight: bold;">
                <button class="btn btn-success" type="button" id="saveBalanceBtn" title="Сохранить баланс">
                    <i class="fas fa-save"></i>
                </button>
                <span class="input-group-text">
            <i class="fas fa-dumbbell" id="balanceIcon"></i>
        </span>
            </div>
            <div class="mt-1">
                <small class="text-muted" id="balanceStatus"></small>
                <div class="form-text">
                    Измените значение и нажмите <i class="fas fa-save"></i> для сохранения
                </div>
                <div id="balanceSaveStatus" class="small"></div>
            </div>
        </div>

        <div class="col-md-4 mb-3">
            <label for="expected_payment_date" class="form-label fw-bold">
                <i class="fas fa-calendar-alt me-1"></i>
                Следующая оплата
            </label>
            <div class="input-group input-group-lg">
                <input type="date" class="form-control" id="expected_payment_date" name="expected_payment_date">
                <span class="input-group-text">
                    <i class="fas fa-clock" id="dateIcon"></i>
                </span>
            </div>
            <div class="mt-1">
                <small class="text-muted" id="dateStatus"></small>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6 mb-3">
            <label for="date_start" class="form-label fw-bold">
                <i class="fas fa-play-circle me-1"></i>
                Дата начала тренировок
            </label>
            <input type="datetime-local" class="form-control" id="date_start" name="date_start">
        </div>

        <div class="col-md-6 mb-3">
            <label for="payment_day" class="form-label fw-bold">
                <i class="fas fa-calendar-day me-1"></i>
                День месяца для оплаты
            </label>
            <input type="number" class="form-control" id="payment_day" name="payment_day" min="1" max="31">
        </div>
    </div>
</div>

<!-- Подключаем модальные окна -->
{% include "partials/modals/payment_modal.html" %}
{% include "partials/modals/medical_certificate_modal.html" %}